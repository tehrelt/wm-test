# wm-test

## Основные возможности

- Создание задач (фоновая обработка через worker pool)
- Получение статуса и результата задачи
- Удаление задачи (c отменой задачи)

## Архитектура

- **Worker pool**: задачи обрабатываются в фоне ограниченным числом воркеров
- **In-memory storage**: все задачи и их статусы хранятся в памяти
- **Context cancellation**: для каждой задачи можно инициировать отмену через API

## Конфигурация

Сервис настраивается через переменные окружения:

| Переменная   | Значение по умолчанию | Описание                              |
| ------------ | --------------------- | ------------------------------------- |
| ENV          | local                 | Окружение запуска: local, dev, prod   |
| PORT         | 8080                  | Порт, на котором стартует HTTP сервер |
| WORKER_COUNT | 4                     | Количество воркеров в пуле            |

Пример запуска с кастомными параметрами:

```sh
ENV=prod PORT=9000 WORKER_COUNT=8 make run
```

## Запуск

```sh
cd wm-test
go run ./cmd/app/main.go
```

Можно также использовать `make` для сборки и запуска сервиса:

```sh
make build
```

Сервис стартует на порту 8080 по умолчанию.

## API

### Создать задачу

```
POST /
```

**Ответ:**

```json
{
  "id": "...uuid...",
  "status": "wait",
  "elapsed": 0,
  "createdAt": "2024-01-01T12:00:00Z",
  "updatedAt": "2024-01-01T12:00:00Z"
}
```

### Получить статус задачи

```
GET /:id
```

**Ответ:**

```json
{
  "id": "...uuid...",
  "status": "processing|done|error|wait",
  "elapsed": 0, // unix timestamp
  "createdAt": "...",
  "updatedAt": "..."
}
```

### Список задач

```
GET /
```

**Ответ:**

```json
{
  "tasks": [ ... ],
  "total": 1
}
```

### Удалить задачу

```
DELETE /:id
```

## Пример работы

1. Создайте задачу:
   ```sh
   curl -X POST http://localhost:8080/
   ```
2. Получите статус:
   ```sh
   curl http://localhost:8080/<task_id>
   ```
